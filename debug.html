<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒ‡ãƒãƒƒã‚°æƒ…å ±</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .info {
      background-color: white;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 8px;
      border-left: 4px solid #4CAF50;
    }
    .error {
      background-color: #ffebee;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 8px;
      border-left: 4px solid #c62828;
      color: #c62828;
    }
    .success {
      background-color: #e8f5e9;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 8px;
      border-left: 4px solid #2e7d32;
      color: #2e7d32;
    }
    pre {
      background-color: #f5f5f5;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
    }
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      font-size: 16px;
      margin: 5px;
    }
  </style>
</head>
<body>
  <h1>ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ±</h1>
  
  <div id="protocol-info" class="info"></div>
  <div id="errors" class="error" style="display: none;"></div>
  <div id="console-log"></div>
  
  <button onclick="testApp()">ã‚¢ãƒ—ãƒªã‚’ãƒ†ã‚¹ãƒˆ</button>
  <button onclick="location.href='index.html'">ã‚¢ãƒ—ãƒªã‚’é–‹ã</button>
  
  <script>
    // ãƒ—ãƒ­ãƒˆã‚³ãƒ«æƒ…å ±ã‚’è¡¨ç¤º
    const protocolInfo = document.getElementById('protocol-info');
    protocolInfo.innerHTML = `
      <strong>ç¾åœ¨ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«:</strong> ${window.location.protocol}<br>
      <strong>URL:</strong> ${window.location.href}<br>
      <strong>User Agent:</strong> ${navigator.userAgent}
    `;
    
    // file:// ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®è­¦å‘Š
    if (window.location.protocol === 'file:') {
      const warning = document.createElement('div');
      warning.className = 'error';
      warning.innerHTML = `
        <strong>âš ï¸ è­¦å‘Š: file:// ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§é–‹ã„ã¦ã„ã¾ã™</strong><br>
        ã“ã®ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã¯ä»¥ä¸‹ã®æ©Ÿèƒ½ãŒåˆ¶é™ã•ã‚Œã¾ã™ï¼š<br>
        â€¢ Service WorkerãŒå‹•ä½œã—ãªã„<br>
        â€¢ ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ãŒè¡¨ç¤ºã•ã‚Œãªã„<br>
        â€¢ ä¸€éƒ¨ã®JavaScriptæ©Ÿèƒ½ãŒåˆ¶é™ã•ã‚Œã‚‹<br>
        <br>
        <strong>è§£æ±ºæ–¹æ³•:</strong><br>
        1. ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’ä½¿ç”¨ã™ã‚‹<br>
        2. Webã‚µãƒ¼ãƒãƒ¼ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹
      `;
      document.body.insertBefore(warning, protocolInfo.nextSibling);
    }
    
    // ã‚¨ãƒ©ãƒ¼ã‚’ã‚­ãƒ£ãƒƒãƒ
    window.addEventListener('error', (event) => {
      const errorsDiv = document.getElementById('errors');
      errorsDiv.style.display = 'block';
      errorsDiv.innerHTML += `
        <strong>ã‚¨ãƒ©ãƒ¼:</strong> ${event.message}<br>
        <strong>ãƒ•ã‚¡ã‚¤ãƒ«:</strong> ${event.filename}<br>
        <strong>è¡Œ:</strong> ${event.lineno}:${event.colno}<br>
        <hr>
      `;
    });
    
    // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£
    const originalLog = console.log;
    const originalError = console.error;
    const consoleLogDiv = document.getElementById('console-log');
    
    console.log = function(...args) {
      originalLog.apply(console, args);
      const div = document.createElement('div');
      div.className = 'info';
      div.innerHTML = '<strong>Log:</strong> ' + args.join(' ');
      consoleLogDiv.appendChild(div);
    };
    
    console.error = function(...args) {
      originalError.apply(console, args);
      const div = document.createElement('div');
      div.className = 'error';
      div.innerHTML = '<strong>Error:</strong> ' + args.join(' ');
      consoleLogDiv.appendChild(div);
    };
    
    // ã‚¢ãƒ—ãƒªã®ãƒ†ã‚¹ãƒˆ
    function testApp() {
      console.log('ã‚¢ãƒ—ãƒªã®ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
      
      // LocalStorageã®ãƒ†ã‚¹ãƒˆ
      try {
        localStorage.setItem('test', 'value');
        localStorage.removeItem('test');
        console.log('âœ“ LocalStorage: å‹•ä½œOK');
      } catch (e) {
        console.error('âœ— LocalStorage: ã‚¨ãƒ©ãƒ¼ - ' + e.message);
      }
      
      // Service Workerã®ãƒ†ã‚¹ãƒˆ
      if ('serviceWorker' in navigator) {
        console.log('âœ“ Service Worker: ã‚µãƒãƒ¼ãƒˆã‚ã‚Š');
        if (window.location.protocol === 'file:') {
          console.error('âœ— Service Worker: file://ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã¯ç™»éŒ²ã§ãã¾ã›ã‚“');
        }
      } else {
        console.error('âœ— Service Worker: ã‚µãƒãƒ¼ãƒˆãªã—');
      }
      
      // Manifestã®ãƒ†ã‚¹ãƒˆ
      if (window.location.protocol !== 'file:') {
        fetch('./manifest.json')
          .then(r => r.json())
          .then(data => console.log('âœ“ Manifest: èª­ã¿è¾¼ã¿OK', data))
          .catch(e => console.error('âœ— Manifest: ã‚¨ãƒ©ãƒ¼ - ' + e.message));
      }
      
      // JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
      const scripts = [
        './js/utils/constants.js',
        './js/models/FoodItem.js',
        './js/app.js'
      ];
      
      scripts.forEach(src => {
        const script = document.createElement('script');
        script.src = src;
        script.onload = () => console.log('âœ“ ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿OK: ' + src);
        script.onerror = () => console.error('âœ— ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ' + src);
      });
    }
  </script>
</body>
</html>
